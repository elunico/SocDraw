<html>

<head>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io('http://192.168.1.169:8000');
    var id;
    socket.on('connected', function (data) {
      console.log("Connected! id=" + data.id);
      id = data.id;
    });
    socket.on('previous data', function (data) {
      for (let d of data.previousData) {
        drawIncomingData(d);
      }
    })
    socket.on('nack', function (data) {
      console.log('Error server got bad data');
    });
    socket.on('incoming drawing', function (data) {
      if (data.source != id) {
        console.log('Got data');
        drawIncomingData(data);
      }
    });
    socket.on('clear canvas', function (data) {
      console.log('received clear');
      clearCanvas();
    });
    socket.on('mouse released', function (data) { last = { x: undefined, y: undefined }; });

    let components = window.location.pathname.split('/');
    let room = components[components.length - 1];

    socket.emit('needs assignment', { room });
  </script>
  <script src="/libraries/p5.js"></script>
  <script src="/libraries/p5.dom.js"></script>
  <script src="/path.js"></script>
  <script src="/sketch.js"></script>

  <style>
    body>* {
      margin: 4px;
    }
  </style>

</head>

<body>
  <h2 id="room-name"></h2>
  <script>
    (function () {
      window.addEventListener("touchstart", function (e) {
        if (e.target == canvas.elt)
          e.preventDefault();
      }, { passive: false });
      window.addEventListener("touchend", function (e) {
        if (e.target == canvas.elt)
          e.preventDefault();
      }, { passive: false });
      window.addEventListener("touchmove", function (e) {
        if (e.target == canvas.elt)
          e.preventDefault();
      }, { passive: false });
    })();

    let roomName = document.querySelector('#room-name');
    roomName.textContent = 'Your room is: ' + window.location.pathname.split('/').pop();
  </script>
</body>

</html>
